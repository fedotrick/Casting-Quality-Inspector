{% extends "base.html" %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞–º–∏{% endblock %}

{% block content %}
<h1>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞–º–∏</h1>

<a href="{{ url_for('ui.work_menu') }}" class="btn btn-secondary">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</a>

<div style="background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 10px;">
    <h3>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞</h3>
    <form id="addControllerForm" onsubmit="addController(event)">
        <div style="display: flex; gap: 10px;">
            <input type="text" id="controllerName" placeholder="–ò–º—è –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞" required style="flex: 1;">
            <button type="submit" class="btn btn-success">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
    </form>
</div>

<h3>–°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–æ–≤</h3>
{% if controllers %}
<table>
    <thead>
        <tr>
            <th>–ò–º—è</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
    </thead>
    <tbody id="controllersTable">
        {% for controller in controllers %}
        <tr id="controller_{{ controller.id }}">
            <td>{{ controller.–∏–º—è }}</td>
            <td>{{ '–ê–∫—Ç–∏–≤–µ–Ω' if controller.–∞–∫—Ç–∏–≤–µ–Ω else '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω' }}</td>
            <td>
                <button class="btn btn-warning" onclick="toggleController({{ controller.id }})">
                    {{ '–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å' if controller.–∞–∫—Ç–∏–≤–µ–Ω else '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å' }}
                </button>
                <button class="btn btn-danger" onclick="deleteController({{ controller.id }})">–£–¥–∞–ª–∏—Ç—å</button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>–ù–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–æ–≤</p>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
async function addController(event) {
    event.preventDefault();
    const name = document.getElementById('controllerName').value;
    
    try {
        const formData = new FormData();
        formData.append('name', name);
        
        const response = await fetch('/api/add-controller', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();
        
        if (data.success) {
            alert('–ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω');
            location.reload();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + data.error);
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
    }
}

async function toggleController(id) {
    try {
        const formData = new FormData();
        formData.append('id', id);
        
        const response = await fetch('/api/toggle-controller', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();
        
        if (data.success) {
            location.reload();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + data.error);
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
    }
}

async function deleteController(id) {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞?')) {
        return;
    }
    
    try {
        const formData = new FormData();
        formData.append('id', id);
        
        const response = await fetch('/api/delete-controller', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();
        
        if (data.success) {
            location.reload();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + data.error);
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
    }
}
</script>
{% endblock %}
